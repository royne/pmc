<div class="container">
  <div class="row justify-content-around container-style">
    <!-- tabla de estudiantes -->
    <div class="col-sm-6">
      <h2 class="title">Estudiantes activos</h2>
      <table class="table table-hover table-sm">
        <thead class="thead-light">
          <tr>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Programa</th>
            <th class="text-center">Ver</th>
            <th class="text-center">Pago</th>
          </tr>
        </thead>
        <% @students.each do |student| %>
          <% if signed_in? && student.user == current_user %>
            <tbody>
              <tr>
                <td><%= student.name %></td>
                <td><%= student.last_name %></td>
                <td><%= student.course %></td>
                <td class="text-center"><a href="/students/<%= student.id %>"><i id="eye-color" class="far fa-eye" style="color: #403E38;"></i></a></td>
                <td class="text-center">
                  <% if student.payments.empty? %>
                    <i class="far fa-money-bill-alt"></i>
                  <% else %>
                    <% if student.payments.last.end_date.strftime("%y%m%d") < @current_date %>
                      <i class="far fa-money-bill-alt" style="color: red;" id="pay-color"></i>
                    <% else %>
                      <i class="far fa-money-bill-alt" style="color: green;" id="pay-color"></i>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            </tbody>
          <% end %>
        <% end %>
      </table>
    </div>

    <div class="col-sm-6">
      <div class="row justify-content-around">
        <!-- numero de estudiantes matriculados -->
        <div class="col-sm-4">
          <div class="">
            <h4 class="title">Estudiantes matriculados: </h4>
            <% @students.each do |student| %>
              <% if student.user_id == current_user.id %>
                <% @array_students_user.push(student) %>
              <% end %>
            <% end %>
            <%= @array_students_user.length %>
          </div>
        </div>
        <!-- formulario de busqueda -->
        <div class="col-sm-4">
          <%= form_tag students_path, method: :get do %>
          <div class="form-group">
            <%= text_field_tag :keyword, nil, class:"form-control form-control-sm", placeholder:"Buscar" %>
          </div>
          <div class="form-group">
            <%= submit_tag "Buscar", name: nil, class: "btn-color btn btn-dark btn-sm btn-block" %>
          </div>
          <% end %>
        </div>
      </div>

      <!-- division -->
      <div class="row justify-content-center">
        <div class="col-sm-11 line-div"></div>
      </div>

      <!-- grafica -->
      <div class="row justify-content-center">
        <div class="col-sm-10">
          <h2 class="title">Estudiantes por Programa</h2>
          <%= pie_chart @user_students.students.group(:course).count %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- grafica de pago por estudiante  -->

<div class="col-sm-11 text-center">
  <a class="btn btn-dark  " data-toggle="collapse" href="#pxs" role="button" aria-expanded="false" >
    <i class="fas fa-users"></i> Pago por Estudiantes
  </a>
  <div class="collapse" id="pxs">
    <% c = [] %>
    <% @array_students_user.each do |q| %>
      <% c << d = Array.new.push(q.name) %>
      <% d << q.payments.sum { |p| p.price } %>
    <% end %>
    <%= bar_chart c, colors:["green"] %>
  </div>
</div>
